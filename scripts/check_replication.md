Основные улучшения:

Функция select_secret:

Показывает нумерованный список всех найденных секретов

Запрашивает выбор пользователя с проверкой корректности ввода

Возвращает выбранное имя секрета

Улучшенная функция get_password_from_secret:

Обрабатывает случай, когда найдено несколько секретов

При одном секрете использует его автоматически

При нескольких - предлагает выбор

Добавлены дополнительные возможные ключи пароля

Выводит список доступных ключей при ошибке извлечения пароля

Улучшенная обработка ошибок:

Проверка на "null" при извлечении пароля

Обработка ошибок в API запросах к Patroni

Экранирование кавычек в SQL запросах

Более информативные сообщения:

Указывает количество найденных секретов

Показывает выбранный секрет

Выводит список доступных ключей при проблемах

Теперь при запуске скрипта, если найдено несколько секретов, вы увидите:

text
Найдено несколько секретов с 'postgres' в имени:
----------------------------------------
1) postgres-secret-production
2) postgres-secret-backup
3) postgres-credentials
----------------------------------------
Выберите номер секрета (1-3): 