üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

–°–∏–Ω—Ç–∞–∫—Å–∏—Å –∑–∞–ø—É—Å–∫–∞

–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫

–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–µ–π

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

–¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞

üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞
–°–∫—Ä–∏–ø—Ç check_replication_v8.sh –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è Patroni –∫–ª–∞—Å—Ç–µ—Ä–∞ –∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ PostgreSQL –≤ Kubernetes-–æ–∫—Ä—É–∂–µ–Ω–∏–∏. –û–Ω –ø–æ–º–æ–≥–∞–µ—Ç:

–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ Patroni –∫–ª–∞—Å—Ç–µ—Ä–∞

–ü—Ä–æ–≤–µ—Ä—è—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ PostgreSQL

–í—ã—è–≤–ª—è—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –Ω–∞ —Ä–∞–Ω–Ω–∏—Ö —ç—Ç–∞–ø–∞—Ö

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏ –Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏

–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é –ø—Ä–æ–±–ª–µ–º

‚öôÔ∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã
bash
kubectl    # –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Kubernetes
jq         # –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ JSON
psql       # –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL
–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
–ß—Ç–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º namespace

–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –≤ –ø–æ–¥–∞—Ö

–î–æ—Å—Ç—É–ø –∫ –ª–æ–≥–∞–º –ø–æ–¥–∞

üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
–°–∫–∞—á–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç

bash
wget -O check_replication_v8.sh https://raw.githubusercontent.com/your-repo/check_replication_v8.sh
–î–∞–π—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

bash
chmod +x check_replication_v8.sh
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —É—Ç–∏–ª–∏—Ç

bash
which kubectl jq psql
üöÄ –°–∏–Ω—Ç–∞–∫—Å–∏—Å –∑–∞–ø—É—Å–∫–∞
bash
./check_replication_v8.sh <pod_name> <port> <namespace> <patroni_version> [password]
–ü–∞—Ä–∞–º–µ—Ç—Ä—ã
–ü–∞—Ä–∞–º–µ—Ç—Ä	–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π	–û–ø–∏—Å–∞–Ω–∏–µ	–ü—Ä–∏–º–µ—Ä –∑–Ω–∞—á–µ–Ω–∏—è
pod_name	‚úÖ	–ò–º—è –ø–æ–¥–∞ —Å Patroni	psql-cdb-backend-main-0
port	‚úÖ	–ü–æ—Ä—Ç PostgreSQL	5432
namespace	‚úÖ	Kubernetes namespace	backend
patroni_version	‚úÖ	–í–µ—Ä—Å–∏—è Patroni (v2 –∏–ª–∏ v4)	v4
password	‚ùå	–ü–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è postgres	mysecretpassword
üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
–ë–∞–∑–æ–≤—ã–π –∑–∞–ø—É—Å–∫ (–ø–∞—Ä–æ–ª—å –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
bash
./check_replication_v8.sh psql-cdb-backend-main-0 5432 backend v4
–ó–∞–ø—É—Å–∫ —Å —è–≤–Ω—ã–º —É–∫–∞–∑–∞–Ω–∏–µ–º –ø–∞—Ä–æ–ª—è
bash
./check_replication_v8.sh psql-cdb-backend-stage2-0 5432 staging v2 mypassword123
–î–ª—è production –æ–∫—Ä—É–∂–µ–Ω–∏—è
bash
./check_replication_v8.sh psql-cdb-backend-prod-0 5432 production v4
–î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –ø–æ–¥–æ–≤
bash
./check_replication_v8.sh psql-cdb-backend-dev-0 5432 development v4
üîç –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫
–°–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç 12 –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫:

1. –°—Ç–∞—Ç—É—Å Patroni —á–µ—Ä–µ–∑ API
–ó–∞–ø—Ä–æ—Å –∫ Patroni API –Ω–∞ –ø–æ—Ä—Ç—É 8008

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ (leader, standby_leader, replica)

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏

2. –°—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ patronictl
–í—ã–≤–æ–¥ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–ª–∞—Å—Ç–µ—Ä–µ —á–µ—Ä–µ–∑ patronictl list

–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö —á–ª–µ–Ω–æ–≤ –∫–ª–∞—Å—Ç–µ—Ä–∞ –∏ –∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π

3. –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤ –ø–æ–¥–∞ ‚ö†Ô∏è
–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ - —Å–∫—Ä–∏–ø—Ç –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º:

–û—à–∏–±–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

–ü—Ä–æ–±–ª–µ–º—ã —Å bootstrap

–°–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏

–ü—Ä–æ–±–ª–µ–º—ã —Å pg_hba.conf

4. –°—Ç–∞—Ç—É—Å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏
–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö —Ä–µ–ø–ª–∏–∫–∞—Ö

–°–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ (streaming, catchup)

–õ–∞–≥ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö

5. –õ–∞–≥ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏
–†–∞–∑–º–µ—Ä –ª–∞–≥–∞ –≤ –±–∞–π—Ç–∞—Ö

–ß–µ–ª–æ–≤–µ–∫–æ-—á–∏—Ç–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç —Ä–∞–∑–º–µ—Ä–∞

6. –°–ª–æ—Ç—ã —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏
–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–ª–æ—Ç–∞—Ö —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏

–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–ª–æ—Ç–æ–≤ (active/inactive)

–†–∞–∑–º–µ—Ä –ª–∞–≥–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–ª–æ—Ç–∞

7. –†–∞–∑–º–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
–†–∞–∑–º–µ—Ä –≤—Å–µ—Ö –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö

–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —É–±—ã–≤–∞–Ω–∏—é —Ä–∞–∑–º–µ—Ä–∞

8. –†–∞–∑–º–µ—Ä data directory
–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –¥–∏—Å–∫–µ

–ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ du -smx

9. –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å WAL
–î–ª—è —Ä–µ–ø–ª–∏–∫: –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ WAL

–î–ª—è –º–∞—Å—Ç–µ—Ä–∞: —Ç–µ–∫—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è WAL

–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—É–∑—ã —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏

10. –°—Ç–∞—Ç—É—Å –ø–æ–ª—É—á–µ–Ω–∏—è WAL (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–µ–ø–ª–∏–∫)
–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏–∑ pg_stat_wal_receiver

–í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

–õ–∞–≥ –ø–æ–ª—É—á–µ–Ω–∏—è WAL

11. –¢–∞–±–ª–∏—á–Ω—ã–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
–°–ø–∏—Å–æ–∫ —Ç–∞–±–ª–∏—á–Ω—ã—Ö –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤

–ò—Ö —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∏ —Ä–∞–∑–º–µ—Ä

12. –õ–æ–≥–∏ –ø–æ–¥–∞
–¶–≤–µ—Ç–æ–≤–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ª–æ–≥–æ–≤ –ø–æ —É—Ä–æ–≤–Ω—è–º

–ü–æ—Å–ª–µ–¥–Ω–∏–µ 5 —Å–æ–æ–±—â–µ–Ω–∏–π –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–≤–Ω—è

–û–±—â–∏–π –æ–±–∑–æ—Ä (10 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å—Ç—Ä–æ–∫)

üìä –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
‚úÖ –ù–æ—Ä–º–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
Patroni API:

json
{"role":"standby_leader","replication_state":"streaming"}
Patronictl:

text
+ Cluster: psql-cdb-backend-main (7082871416690173313) ----+---------+----+-----------+
| Member                    | Host        | Role         | State   | TL | Lag in MB |
+---------------------------+-------------+--------------+---------+----+-----------+
| psql-cdb-backend-main-0   | 10.244.1.10 | Standby Leader| running |  1 |           |
| psql-cdb-backend-main-1   | 10.244.1.11 | Replica      | running |  1 |         0 |
+---------------------------+-------------+--------------+---------+----+-----------+
–†–µ–ø–ª–∏–∫–∞—Ü–∏—è:

–õ–∞–≥ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏: 0 –±–∞–π—Ç

–°–æ—Å—Ç–æ—è–Ω–∏–µ: streaming

–°–ª–æ—Ç—ã —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏: active

‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
–í—ã—Å–æ–∫–∏–π –ª–∞–≥ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏:

text
replication_lag_bytes: 104857600
replication_lag_pretty: 100MB
–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ —Å–ª–æ—Ç—ã:

text
active: false
‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
–ü—Ä–æ–±–ª–µ–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:

text
password authentication failed for user "standby"
–ü—Ä–æ–±–ª–µ–º—ã —Å–µ—Ç–∏:

text
connection to server at "172.16.0.212", port 30122 failed
–û—à–∏–±–∫–∏ bootstrap:

text
Failed to bootstrap cluster
üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–µ–π
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å–∫—Ä–∏–ø—Ç–∞
–ü—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ —Å–∫—Ä–∏–ø—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

1. –ü—Ä–æ–±–ª–µ–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã
kubectl get secrets -n <namespace> | grep <branch-name>

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞—Ä–æ–ª—å standby –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
kubectl get secret -n <namespace> <secret-name> -o jsonpath='{.data.password}' | base64 -d
2. –ü—Ä–æ–±–ª–µ–º—ã —Å–µ—Ç–∏
bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –º–∞—Å—Ç–µ—Ä–∞
kubectl exec -it -n <namespace> <pod-name> -- ping <master-ip>

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ø–æ—Ä—Ç—É
kubectl exec -it -n <namespace> <pod-name> -- telnet <master-ip> <port>
3. –ü—Ä–æ–±–ª–µ–º—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Patroni
kubectl exec -it -n <namespace> <pod-name> -- cat /etc/patroni/patroni.yml

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
kubectl logs -n <namespace> <pod-name> -f
–†—É—á–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞
bash
# –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∞—Å—Ç–µ—Ä–µ
kubectl exec -it -n <namespace> <pod-name> -- patronictl list

# –ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–π
kubectl exec -it -n <namespace> <pod-name> -- patronictl history
–ü—Ä–æ–≤–µ—Ä–∫–∞ PostgreSQL
bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
kubectl exec -it -n <namespace> <pod-name> -- psql -U postgres -c "SELECT version();"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏
kubectl exec -it -n <namespace> <pod-name> -- psql -U postgres -c "SELECT * FROM pg_stat_replication;"
üõ† –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
bash
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è Patroni
watch -n1 'kubectl exec -it -n backend psql-cdb-backend-main-0 -- patronictl list'

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏
watch -n1 'kubectl exec -it -n backend psql-cdb-backend-main-0 -- psql -U postgres -c "SELECT application_name, state, sync_state, pg_wal_lsn_diff(pg_current_wal_lsn(), replay_lsn) as lag_bytes FROM pg_stat_replication;"'
–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
bash
# –¢–æ–ø —Å–∞–º—ã—Ö –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü
kubectl exec -it -n backend psql-cdb-backend-main-0 -- bash -c "PGPASSWORD=\"$password\" psql -U postgres -c \"SELECT schemaname, tablename, pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) as size FROM pg_tables WHERE schemaname NOT IN ('pg_catalog', 'information_schema') ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC LIMIT 10;\""

# –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
kubectl exec -it -n backend psql-cdb-backend-main-0 -- psql -U postgres -c "SELECT pid, query_start, state, query FROM pg_stat_activity WHERE state = 'active' AND query NOT LIKE '%pg_stat_activity%';"
–†–∞–±–æ—Ç–∞ —Å –ª–æ–≥–∞–º–∏
bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
kubectl logs -n backend psql-cdb-backend-main-0 -f

# –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö
kubectl logs -n backend psql-cdb-backend-main-0 --tail=100 | grep -i error

# –õ–æ–≥–∏ –∑–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥
kubectl logs -n backend psql-cdb-backend-main-0 --since=1h
üé® –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞
üî¥ –ö—Ä–∞—Å–Ω—ã–π - –æ—à–∏–±–∫–∏ –∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

üü¢ –ó–µ–ª–µ–Ω—ã–π - —É—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–±–ª–µ–º

üü° –ñ–µ–ª—Ç—ã–π - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

üîµ –°–∏–Ω–∏–π - –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Ä–∞–∑–¥–µ–ª–æ–≤

üî∑ –ì–æ–ª—É–±–æ–π - –≤—ã–ø–æ–ª–Ω—è–µ–º—ã–µ –∫–æ–º–∞–Ω–¥—ã

üü£ –§–∏–æ–ª–µ—Ç–æ–≤—ã–π - –ª–æ–≥–∏ –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã

üü† –û—Ä–∞–Ω–∂–µ–≤—ã–π - WARN-–ª–æ–≥–∏

üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞
–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—É—Å–∫–∞ - —É–±–µ–¥–∏—Ç–µ—Å—å –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –∏–º–µ–Ω–∏ –ø–æ–¥–∞, namespace –∏ –≤–µ—Ä—Å–∏–∏ Patroni

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —É—Ç–∏–ª–∏—Ç - —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã kubectl, jq, psql

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ - —É–±–µ–¥–∏—Ç–µ—Å—å –≤ –Ω–∞–ª–∏—á–∏–∏ –ø—Ä–∞–≤ –Ω–∞ —á—Ç–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –≤ –ø–æ–¥–∞—Ö

–°–æ–±–µ—Ä–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:

bash
# –í–µ—Ä—Å–∏—è Kubernetes
kubectl version

# –î–æ—Å—Ç—É–ø–Ω—ã–µ namespaces
kubectl get namespaces

# –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ–¥—ã
kubectl get pods -n <namespace>
