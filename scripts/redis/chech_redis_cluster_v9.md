–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞
–°–∫—Ä–∏–ø—Ç check_redis_cluster_v9.sh –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è Redis –∫–ª–∞—Å—Ç–µ—Ä–∞ –∏ Sentinel –≤ Kubernetes –æ–∫—Ä—É–∂–µ–Ω–∏–∏. –û–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ:

–°–æ—Å—Ç–æ—è–Ω–∏–∏ Redis –ø–æ–¥–æ–≤ (–º–∞—Å—Ç–µ—Ä/—Ä–µ–ø–ª–∏–∫–∞)

–†–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –º–µ–∂–¥—É –Ω–æ–¥–∞–º–∏

–°–æ—Å—Ç–æ—è–Ω–∏–∏ Sentinel

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –ø–∞–º—è—Ç–∏ –∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è—Ö

–õ–æ–≥–∞—Ö –∏ –º–µ—Ç—Ä–∏–∫–∞—Ö

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
–î–æ—Å—Ç—É–ø –∫ Kubernetes –∫–ª–∞—Å—Ç–µ—Ä—É

–£—Ç–∏–ª–∏—Ç–∞ kubectl –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏ –¥–æ—Å—Ç—É–ø–Ω–∞

–ü—Ä–∞–≤–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º namespace

–î–æ—Å—Ç—É–ø –∫ Redis/Sentinel –ø–æ–¥–∞–º

–°–∏–Ω—Ç–∞–∫—Å–∏—Å
bash
./check_redis_cluster_v9.sh <pod_name> <namespace> [port] [password]
–ü–∞—Ä–∞–º–µ—Ç—Ä—ã
pod_name (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) - –∏–º—è –ø–æ–¥–∞ Redis –∏–ª–∏ Sentinel

Redis: rfr-* (–Ω–∞–ø—Ä–∏–º–µ—Ä: rfr-pickup-main-redis-0)

Sentinel: rfs-* (–Ω–∞–ø—Ä–∏–º–µ—Ä: rfs-pickup-stage2-redis-68bc8fc5c9-q26cv)

namespace (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) - Kubernetes namespace –≥–¥–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã –ø–æ–¥—ã

port (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π) - –ø–æ—Ä—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 6379 –¥–ª—è Redis, 26379 –¥–ª—è Sentinel)

password (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π) - –ø–∞—Ä–æ–ª—å Redis (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω, –±—É–¥–µ—Ç –ø–æ–ª—É—á–µ–Ω –∏–∑ —Å–µ–∫—Ä–µ—Ç–∞)

–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
–ë–∞–∑–æ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ Redis –ø–æ–¥–∞
./check_redis_cluster_v9.sh rfr-pickup-main-redis-0 pickup-main

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Sentinel –ø–æ–¥–∞
./check_redis_cluster_v9.sh rfs-pickup-stage2-redis-68bc8fc5c9-q26cv pickup-stage2

# –° —É–∫–∞–∑–∞–Ω–∏–µ–º –ø–æ—Ä—Ç–∞
./check_redis_cluster_v9.sh rfr-pickup-main-redis-0 pickup-main 6379

# –° —É–∫–∞–∑–∞–Ω–∏–µ–º –ø–∞—Ä–æ–ª—è
./check_redis_cluster_v9.sh rfr-pickup-main-redis-0 pickup-main 6379 mypassword
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø –ø–æ–¥–∞ (Redis/Sentinel) –ø–æ –ø—Ä–µ—Ñ–∏–∫—Å—É –∏–º–µ–Ω–∏

–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–ª–∞—Å—Ç–µ—Ä–∞ –∏–∑ –∏–º–µ–Ω–∏ –ø–æ–¥–∞

–ù–∞—Ö–æ–¥–∏—Ç –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –ø–æ–¥—ã –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ

–ü–æ–ª—É—á–∞–µ—Ç –ø–∞—Ä–æ–ª—å –∏–∑ Kubernetes secret –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω —è–≤–Ω–æ

–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–∫—Ä–∏–ø—Ç
–î–ª—è Redis –ø–æ–¥–æ–≤
–†–æ–ª—å (–º–∞—Å—Ç–µ—Ä/—Ä–µ–ø–ª–∏–∫–∞)

–°—Ç–∞—Ç—É—Å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏

–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö —Ä–µ–ø–ª–∏–∫

–°–º–µ—â–µ–Ω–∏–µ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏

–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

–í—Å–µ –Ω–æ–¥—ã –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ

–î–ª—è Sentinel –ø–æ–¥–æ–≤
–°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–≤–æ—Ä—É–º–∞

–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–∞—Å—Ç–µ—Ä–µ

–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö Sentinel

–°–ø–∏—Å–æ–∫ —Ä–µ–ø–ª–∏–∫

–°—Ç–∞—Ç—É—Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
–°–∫—Ä–∏–ø—Ç –≤—ã–≤–æ–¥–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —Ü–≤–µ—Ç–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ:

üî¥ –ö—Ä–∞—Å–Ω—ã–π - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏

üü¢ –ó–µ–ª–µ–Ω—ã–π - —É—Å–ø–µ—à–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

üü° –ñ–µ–ª—Ç—ã–π - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

üîµ –°–∏–Ω–∏–π - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

üü£ –§–∏–æ–ª–µ—Ç–æ–≤—ã–π - –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Ä–∞–∑–¥–µ–ª–æ–≤

üü† –û—Ä–∞–Ω–∂–µ–≤—ã–π - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
–í –∫–æ–Ω—Ü–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≥–æ—Ç–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏:

–ö–æ–º–∞–Ω–¥—ã –¥–ª—è Redis
bash
# –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö Redis
kubectl get pods -n <namespace> | grep '<base_pod_name>-'

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ Redis
kubectl exec -n <namespace> <redis_pod> -- redis-cli -p 6379 info

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é
kubectl exec -n <namespace> <redis_pod> -- redis-cli -p 6379 info replication

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
kubectl logs -n <namespace> <redis_pod> -f
–ö–æ–º–∞–Ω–¥—ã –¥–ª—è Sentinel
bash
# –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Å–µ–Ω—Ç–∏–Ω–µ–ª–æ–≤
kubectl get pods -n <namespace> | grep 'rfs-<cluster_id>-redis-'

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–µ–Ω—Ç–∏–Ω–µ–ª–µ
kubectl exec -n <namespace> <sentinel_pod> -- redis-cli -p 26379 info sentinel

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∞—Å—Ç–µ—Ä–∞
kubectl exec -n <namespace> <sentinel_pod> -- redis-cli -p 26379 sentinel masters
–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞
–°–∫—Ä–∏–ø—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏–º—è –ø–æ–¥–∞ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Ö–æ–¥–∏—Ç –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –ø–æ–¥—ã –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ –ø–æ —à–∞–±–ª–æ–Ω–∞–º:

Redis: rfr-<service>-<environment>-redis-*

Sentinel: rfs-<service>-<environment>-redis-*

–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Å –ø–∞—Ä–æ–ª–µ–º

–ü–∞—Ä–æ–ª—å –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –∏–∑ Kubernetes secret

–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

–ö–æ–ºprehensive –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤—Å–µ—Ö –Ω–æ–¥ –∫–ª–∞—Å—Ç–µ—Ä–∞

–ê–Ω–∞–ª–∏–∑ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏

–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤

–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–≤–æ—Ä—É–º–∞ Sentinel

–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
–î–ª—è –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–µ–π –æ–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —Ä–∞–∑–¥–µ–ª "–í—Å–µ Redis –Ω–æ–¥—ã –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ"

–î–ª—è –∞–Ω–∞–ª–∏–∑–∞ failover –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ Sentinel

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –ø–∞–º—è—Ç—å—é –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –ø–∞–º—è—Ç–∏

–î–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤

–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫
–ï—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ kubectl –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É namespace

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ–¥ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ Running

–ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —É–∫–∞–∂–∏—Ç–µ –ø–∞—Ä–æ–ª—å —è–≤–Ω–æ

–î–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –æ—Ç–ª–∞–¥–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ set -x –≤ –Ω–∞—á–∞–ª–µ —Å–∫—Ä–∏–ø—Ç–∞

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ø—Ä–æ—â–∞–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É Redis –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ –≤ Kubernetes, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—è –µ–¥–∏–Ω—É—é —Ç–æ—á–∫—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.